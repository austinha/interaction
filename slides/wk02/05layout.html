---
layout: presentation
title: Layout --Week 2, Monday-- 
description: Description of Layout
class: middle, center, inverse
---
name: inverse
layout: true
class: center, middle, inverse
---
# Introduction to Layout

---
layout: false

.left-column50[![:img Color Meter Mac App -- shows the RGB values for whatever pixel the cursor is over, 90%](img/colormeter.png)]
--
.right-column50[
Let's list all the interactors
]

---

.left-column50[![:img Color Meter Mac App -- shows the RGB values for whatever pixel the cursor is over, 90%](img/colormeter.png)]

.right-column50[
Let's list all the interactors

And arrange them in a tree
]

---

.left-column[![:img Color Meter Mac App -- shows the RGB values for whatever pixel the cursor is over, 150%](img/colormeter.png)]

.right-column[
<div class="mermaid">
graph LR
W((Window)) --> L(LeftSide:Display)
W --> R(RightSide:Settings)
L --> M[Icon:Mag Window]
L --> A[Slider:Aperture Size]
L --> C[Menu:Choice]
R --> D(RGB Display)
D --> I[Icon:Color]
D --> T[Text:RGB]
R --> La[Text:Label]

classDef bluegreen fill:#669999,stroke:#333,stroke-width:2px;
classDef blue fill:#7887AB,stroke:#333,stroke-width:2px;
classDef green fill:#88CC88,stroke:#333,stroke-width:4px;
</div>
]

---


.left-column[![:img Color Meter Mac App -- shows the RGB values for whatever pixel the cursor is over, 150%](img/colormeter.png)]

.font-small.right-column[
<div class="mermaid">
graph LR
W((Window)) --> M[Icon:Mag Window]
W --> A[Slider:Aperture Size]
W --> C[Menu:Choice]
W --> I[Icon:Color]
W --> T[Text:RGB]
W --> La[Text:Label]

classDef bluegreen fill:#669999,stroke:#333,stroke-width:2px;
classDef blue fill:#7887AB,stroke:#333,stroke-width:2px;
classDef green fill:#88CC88,stroke:#333,stroke-width:4px;
</div>
]

---
.left-column[
# Remember the Widget abstraction?
]
.right-column[
Each interactor knows how to draw itself

Doesn't have to worry about position, clipping, etc

... So how is position defined?
]
---
## Container Widgets

Help with layout

Manage size and position of children
- Enforce widget abstraction

- Simple loop through child interactors --> Recursive tree traversal 

 - Translate child to correct location

 - Clip child after drawing is complete

Know how to handle resizing (reactive)

???
Parent knows how to setup for drawing of children, invoke their drawing code, and add additional output (before and/or after) based on what the parent is and its internal state

---
## What do container widgets need to do this?

Ideally:
- widget's preferred size

- widget's minimum size

- widget's maximum size

And they get to ignore all of that, but usually try not to.
---
# Absolute layout -- actual implementation (slightly simplified)

```java
protected void onLayout(boolean changed, int l, int t, int r, int b) {
    foreach child c {
        if (child.isVisible()) {
             Rectangle r = child.getLayoutParams();
             childLeft = padding + r.x;
             childTop = padding + r.y;
             child.layout(childLeft, childTop, r.w, r.h);
        }
    }
}
```

This is a simple depth first tree traversal

---
# Relative layout implementation
Simplified, basic structure for any Android layout, including your own custom one! 

```java
// Two pass traversal of widget hierarchy
// First: Measure everything
protected void onMeasure(int widthspec, int heightspec) {
  sortChildren()
  // loop through children
  foreach child widget c {
    // get child's layout params
    // apply appropriate rules to them
  }
  // based on all that, update our dimensions
  setMeasuredDimension(this)
}
// Second: do the actual updating 
public void doLayout(Rectangle newBounds)
{
   // loop through the kids (this is depth first)
   foreach child {
      if (child.isVisible()) {
        // get the saved parameters
        Rectangle l = child.getLayoutParams();
        child.layout(l.mLeft, l.mTop, l.mRight, l.mBottom);
      }
   }			    }
```

---

.left-column[![:img Color Meter Mac App -- shows the RGB values for whatever pixel the cursor is over, 150%](img/colormeter-highlights.png)]

.right-column[
<div class="mermaid">
graph LR
W((Window)) --> L(LeftSide:Display)
W --> R(RightSide:Settings)
L --> M[Icon:Mag Window]
L --> A[Slider:Aperture Size]
L --> C[Menu:Choice]
R --> D(RGB Display)
D --> I[Icon:Color]
D --> T[Text:RGB]
R --> La[Text:Label]

classDef bluegreen fill:#669999,stroke:#333,stroke-width:2px;
classDef blue fill:#7887AB,stroke:#333,stroke-width:2px;
classDef green fill:#88CC88,stroke:#333,stroke-width:4px;

class L blue
</div>
]


---

.left-column[![:img Color Meter Mac App -- shows the RGB values for whatever pixel the cursor is over, 150%](img/colormeter-highlights.png)]

.right-column[
<div class="mermaid">
graph LR
W((Window)) --> L(LeftSide:Display)
W --> R(RightSide:Settings)
L --> M[Icon:Mag Window]
L --> A[Slider:Aperture Size]
L --> C[Menu:Choice]
R --> D(RGB Display)
D --> I[Icon:Color]
D --> T[Text:RGB]
R --> La[Text:Label]

classDef bluegreen fill:#669999,stroke:#333,stroke-width:2px;
classDef blue fill:#7887AB,stroke:#333,stroke-width:2px;
classDef green fill:#88CC88,stroke:#333,stroke-width:4px;

class R green
</div>
]

---

.left-column[![:img Color Meter Mac App -- shows the RGB values for whatever pixel the cursor is over, 150%](img/colormeter-highlights.png)]

.right-column[
<div class="mermaid">
graph LR
W((Window)) --> L(LeftSide:Display)
W --> R(RightSide:Settings)
L --> M[Icon:Mag Window]
L --> A[Slider:Aperture Size]
L --> C[Menu:Choice]
R --> D(RGB Display)
D --> I[Icon:Color]
D --> T[Text:RGB]
R --> La[Text:Label]

classDef bluegreen fill:#669999,stroke:#333,stroke-width:2px;
classDef blue fill:#7887AB,stroke:#333,stroke-width:2px;
classDef green fill:#88CC88,stroke:#333,stroke-width:4px;

class D bluegreen
</div>
]

---
.left-column[## How do Container Widgets actually do layout?]

.right-column[
Key Issues:

Where do components get placed?

How much space should they occupy?

How to react to changes

- number of components
- size of window

Brainstorm strategies
]
???
- hardcode size and position of everything -- won't work
- discussion of whorfian effects?
- boxes and springs
- floats
- constraints ('reactive programming')
- others?

---
## Powerful option: Constraints

Declare relationships (.red[what] should be true)

System automatically maintains relationships under change (.red[how])

---
## Powerful option: Constraints

Declare relationships (what should be true)

- This should be centered in that

- This should be 12 pixels to the right of that

- Parent should be 5 pixels larger than child

System automatically maintains relationships under change (how)

--
Too good to be true?

--

Unsolvable for arbitrary things

Works really well for a limited set
??
a good set for ui programming
xx need to make sure I know why it is hard for arbitrary things

---
#Conceptual form of UI constraints

``` java
// this is 5 pixels to the right of that
this.x = that.x + that.w + 5
// this is centered
this.x = that.x + that.w/2 - this.w/2
// this is 10 larger than children
this.w = 10 + max_child().x + max_child().w
```
---
## Note that these are one-way constraints

You can change the right side, and it will update the left side (not
the reverse)

Can be very inefficient -- O(2^n)

But highly efficient incremental update algorithms exist

???

Only have to update things that might change

Hudson's work on this was seminal

can have a DAG but not a cycle (thus, a tree)
hard to guard against cycles
---
.left-column[## How is this done in Android?]
.right-column[
Limited set of constraints: 3 main types

- Fixed size I--I

- Match Constraint IvvvI

- Wrap constraint >>>
]

--
.right-column[Range of attachment options (e.g. button sides, corners)]

---
.left-column[## How is this done in Android?]
.right-column[
Handled with a set of abstractions associated with a container
widget

 - Specified in the GUI (Chapter 18 & 19)

 - Can also be specified or viewed in XML (Chapter 21 describes)


]
--
.right-column[

Additional abstractions <br>
(e.g. groups; guidelines &amp; barriers; chains
]

---
# Discussion of specific inheritance hierarchy for constraints

XXX TODO link to javadocs

- Only have to write once when we use classes properly
- can mix and match things

---

# Example

XXX TODO need picture and description. Potentially see scott's slides
for ideas?
XXX TODO look closer at android code -- xml doesn't look much like --
-- equations!!

---
# Example 2
XXX figure out how to recreate different layouts
XXX make sure to have resizing in examples

????
note that they can be hard to debug?

---

# In Lab: Layout (solo)
Learning goals: Create a layout to a spec
 - Reproduce three layouts we give you
 - Should position things as shown in the image
 - Should resize appropriately if phone is turned

# Exercise: Event Handling XX main assignment? (solo)
Learning goals: React to events
 - Reproduce an interactor we give you
 - Should use a state machine to manage feedback
 - Should handle error cases appropriately


