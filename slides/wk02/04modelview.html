---
layout: presentation
title: Event Handling and Essential Geometry --Week 2, Monday-- 
description: Description of how Event Handling causes Geometry Updates
class: middle, center, inverse
---
name: inverse
layout: true
class: center, middle, inverse
---

# Discussion of Events: Logical Device Approach

???

- Helps us deal with a diversity of devices

- Make sure everyone understands types of events

- Make sure everyone has a basic concept of how one registers listeners

---
name: normal
layout: true
class: 
---

.left-column[
## Is there a higher level abstraction here?
]

--
.right-column[
- Valuator → returns a scalar value

- Button → returns integer value

- Locator → returns position on a logical view surface

- Keyboard → returns character string

- Stroke → obtain sequence of points

- Pick → select an object
]

???

- Can obscure important differences -- hence use inheritance

- Discussion of mouse vs pen -- what are some differences?

- Will discuss this all in more depth in the upcoming lecture on event handling

---
class: inverse, center

# Quiz on Input Events
---
class: inverse, center

# Discussion of Listeners

???

- Implementation strategy

- Basic goal: notify the view of a change
---

.left-column[
## View Update: Based on Essential Geometry
]

.right-column[
- Supports feedback to user

![:img google doc with scrollbar, 50%](img/window.png)
]

???
Examples?

---

.left-column[
## View Update: Based on Essential Geometry
]

.right-column[
- Supports feedback to user

![:img google doc with scrollbar, 50%](img/window-with-menu.png)
]

---

.left-column[
## View Update: Based on Essential Geometry
]

.right-column[
- Supports feedback to user

![:img google doc with scrollbar, 50%](img/window-with-menu-highlight.png)
]

---

.left-column[
## View Update: Based on Essential Geometry
]

.right-column[
- Supports feedback to user

![:img google doc with scrollbar, 50%](img/window-with-menu-highlight2.png)
]

???
What is the essential geometry of this menu?
---


.left-column[
## View Update: Based on Essential Geometry
]

.right-column[
- Supports feedback to user

- Requires redraw on toolkit side
]

???
why? 

---
.left-column[
## View Update: Based on Essential Geometry
]

.right-column[
- What should be redrawn?

![:img google doc with scrollbar, 50%](img/window.png)
]

---

.left-column[
## View Update: Based on Essential Geometry
]

.right-column[
- What should be redrawn?

![:img google doc with scrollbar, 50%](img/window-with-menu.png)
]
---

.left-column[
## View Update: Based on Essential Geometry
]

.right-column[
- What should be redrawn?

![:img google doc with scrollbar, 50%](img/combined.png)
]

---
.left-column[
## View Update: Damage Mechanism
]
.right-column[
- How does the toolkit know what to redraw?

 - Let the widget report

 - Aggregate

 - Usually calculate bounding box
]
---
.left-column[
## View Update: Draw/Redraw Mechanism
]
.right-column[
- Virtual device abstraction provided by windowing system
]

???

Allows each program to (mostly) pretend that it has the screen (frame
buffer) to itself

---
.left-column[
## View Update: Draw/Redraw Mechanism
]
.right-column[
- Virtual device abstraction provided by windowing system

- Widget abstraction provided by toolkit
]

???

Allows each widget to (mostly) pretend that it has the screen to
itself

---
.left-column[
## View Update: Draw/Redraw Mechanism
]
.right-column[
- Virtual device abstraction provided by windowing system

- Widget abstraction provided by toolkit
 - Enforced using clipping
 - Supported using coordinate system transformations
]

---
.left-column[
## View Update: Redraw Mechanism
]
.right-column[
- Damage caused by drawing (or other things)
]
???
Can you think about other things?
- Window hidden and re-exposed
- Resizing
- redrawing

---
.left-column[
## View Update: Redraw Mechanism
]

.right-column[
- Damage caused by drawing (or other things)

- Naive approach to redraw -- problems?
]
---

.left-column[
## View Update: Redraw Mechanism
]
.right-column[
- Damage caused by drawing (or other things)

- Naive approach to redraw -- problems?
]
![:img pic of original screen and changed screen, 72%](img/original-new.png)


???
XXX TODO ADD pic like this using divs?

- Can be slow (redrawing everything unecessary)
- Can cause flickering
 - double buffering is better,
 - hence the 'Canvas' abstraction or equivalent
 - can then switch which FB is displayed (very fast)

---
.left-column[
## View Update: Redraw Mechanism
]

.right-column[
- Damage caused by drawing (or other things)

- Naive approach to redraw -- problems?
]
![:img pic of original screen and changed screen, 72%](img/original-new.png)
![:img pic with double buffering included, 70%](img/full-solution-buffering.png)

---
.left-column[
## View Update: Redraw Mechanism
]

.right-column[
- Damage caused by drawing (or other things)

- Naive approach to redraw -- problems?
]
![:img pic of original screen and changed screen, 72%](img/original-new.png)
![:img pic with double buffering included, 70%](img/full-solution-buffering.png)

.right-column[
- **Never** just draw
 - Why not? 
]

???
- Update *state*
- Report *damage* (by calling 'repaint())
- Wait for *toolkit to request redraw*
 (also works if damage comes from elsewhere)
- How does it generalize to any cause of damage (always need state!!)

---
.left-column[
## View Update: Propagating Damage
]

.right-column[
How do you decide what is damaged?

Class exercise... Trivial reject test
]


???
Integer arithmetic

trivial reject test
 - compare diagonal of damage region (bounding box)
 - to bounding box of

each widget
---

# In Lab: Layout (solo)
Learning goals: Create a layout to a spec
 - Reproduce three layouts we give you
 - Should position things as shown in the image
 - Should resize appropriately if phone is turned

???
xxx todo: move this to appropriate place
--- 
# Exercise: Event Handling XX main assignment? (solo)
Learning goals: React to events
 - Reproduce an interactor we give you
 - Should use a state machine to manage feedback
 - Should handle error cases appropriately

???
xxx todo: move this to appropriate place

